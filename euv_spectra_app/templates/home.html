{% extends 'base.html' %}

{% block title %}Home{% endblock %}
{% block content %}

    <div class="container" onload="checkSession()">     
        
        <div id="overlay">
            <div class="d-flex justify-content-center">
                <div id="loading"></div>
            </div>
        </div>

        <div class="col-sm-10 offset-sm-1 mt-1"> 
            <div class="row d-flex align-items-center">
                <div class="col-sm-2">
                    <img src="{{url_for('static', filename='imgs/icon.png')}}" alt="" class="img img-fluid px-3 py-3">
                </div>
                <div class="col-sm-10">
                    <h2>Find the Extreme Ultraviolet Spectrum for your Star</h2>
                </div>
            </div>
            <p>The PHOENIX EUV Grid and Stellar UV Spectra (PEGASUS) webtool returns a generalized high resolution (Δλ < 0.01 Å) synthetic extreme ultraviolet (EUV; 100-1000 Å) spectrum for a searched target star of the M or K spectral type.</p>
            <p>Required inputs for returning a spectrum are effective temperature, surface gravity, mass, radius, distance, and GALEX FUV and NUV fluxes.</p>
            <p>Users have the option to use Star Name or ICRS coordinates to query the catalogs detailed on our <a href="">About</a> page to retrieve these parameters or they can enter the values manually.</p>
            <!--<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>-->
        </div>

        <div class="row mt-5">
            <div class="col-md-6" id="home-left-col">
                <p class="text-center mb-4"><b>Search for Stellar Parameters by Name</b></p>
                <!--—————————NAME FORM——————————-->
                {% include 'partials/name_form.html' %}

                <p id="home-or" class="my-5"><span>or</span></p>

                <p class="text-center mb-4"><b>Search for Stellar Parameters by J2000 Coordinates</b></p>
                <!--—————————POSITION FORM——————————-->
                {% include 'partials/position_form.html' %}
            </div>

            <div class="col-md-6">
                <p class="text-center mb-4"><b>Enter Stellar Parameters and Fluxes Manually</b></p>
                {% include 'partials/parameter_form.html' %}
            </div>


            {% if show_modal %}
                <div class="modal fade" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <p class="mt-2 ms-4">
                                    The following catalogs returned data for your target: <b>{{ session.star_name }}</b> <br> 
                                    Select the values you wish to use below or enter manually.
                                </p>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {% include 'partials/modal_form.html' %}
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    var myModalEl = document.getElementById('myModal');
                    var modal = new bootstrap.Modal(myModalEl);
                    modal.show();
                </script>
            {% endif %}

        </div>

        <div class="text-center my-5">
            {{ parameter_form.submit(class="btn btn-primary", for="parameter-form", id="flux-continue-btn", form="parameter-form") }}
        </div>
    </div>
{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename='js/loader.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal_form.js') }}"></script>
    <script>
        function checkSession() {
            var inputs;
            const session = JSON.parse('{{ session|tojson|safe }}');
            console.log(session);

            inputs = document.getElementsByClassName('form-control');

            for (i = 0; i < inputs.length; i++){
                if((session.hasOwnProperty(inputs[i].name)) && (inputs[i].name != 'csrf_token')){
                    console.log(inputs[i]);
                    console.log(session[inputs[i].name]);
                    inputs[i].value = session[inputs[i].name];
                };};};

        window.onload = checkSession;
    </script>

    <!-- <script type="text/javascript">
        

        function showModal() {
            var myModalEl = document.getElementById('myModal');
            var modal = new bootstrap.Modal(myModalEl);
            modal.show();
        };


//—————————————————————————LOADER START————————————————————————
        const loader = document.querySelector("#loading");
        const overlay = document.getElementById("overlay");
        
        // showing loading
        function displayLoading() {
            loader.classList.add("display");
            overlay.style.display = "block";
        }

        // hiding loading
        function hideLoading() {
            loader.classList.remove("display");
            overlay.style.display = "none";
        }
//—————————————————————————LOADER END————————————————————————


//—————————————————————————SELECT ALL START————————————————————————
        function selectAll(obj) {
            console.log(obj.id)

            // get all selectall buttons
            const selectAllBtns = document.getElementById('star_name_parameter_form_table').querySelectorAll(`[id*="catalog_name"]`);
            console.log(selectAllBtns)
            // check to make sure no other select all buttons are checked
            for (i=0; i < selectAllBtns.length; i++) {
                if ( selectAllBtns[i].id != obj.id ) {
                    selectAllBtns[i].checked = false;
                }
            };

            // get identifying number
            const num = obj.id.match(/(\d+)/)[0];
            // get all radios w identifying number
            const btns = document.getElementById('star_name_parameter_form_table').querySelectorAll(`[id*="${num}"]`);
            // check radio btns
            for( i = 0 ; i < btns.length ; i++ ) {
                btns[i].checked = true;
            };
        };

        function selectAllGalex(obj) {
            console.log(obj.id)
            const fuvBtn = document.getElementById('fuv-0').checked = true;
            const nuvBtn = document.getElementById('nuv-0').checked = true;
        }
//—————————————————————————SELECT ALL END————————————————————————


        function checkManualRadio(obj) {
            obj.previousElementSibling.checked = true;
        };

        function checkManualInputs(){
            // check all radio buttons and if a manual radio button is clicked assign the value to 
            const manualBtns = document.querySelectorAll(`[id*="{{ last_num }}"]`);
            for(i = 0; i < manualBtns.length; i++){
                if (manualBtns[i].checked) {
                    const newVal = manualBtns[i].nextElementSibling.value
                    manualBtns[i].value = newVal
                };
            };
            return true; // submit the form
        };
    
        function checkSession() {
            var inputs;
            const session = JSON.parse('{{ session|tojson|safe }}');
            console.log(session);

            // inputs = document.getElementsByTagName('input');
            inputs = document.getElementsByClassName('form-control');

            for (i = 0; i < inputs.length; i++){
                if((session.hasOwnProperty(inputs[i].name)) && (inputs[i].name != 'csrf_token')){
                    console.log(inputs[i]);
                    console.log(session[inputs[i].name]);
                    inputs[i].value = session[inputs[i].name];
                };
            };
        };

        window.onload = checkSession;

    </script> -->
{% endblock %}