{% extends 'base.html' %}

{% block title %}{% endblock %}
{% block content %}

    <div class="container">

        
        <div id="overlay">
            <div id="loading"></div>
        </div>

        <div class="col-sm-8 offset-sm-2 mt-3"> 
            <div class="row d-flex align-items-center">
                <div class="col-sm-3">
                    <img src="{{url_for('static', filename='imgs/logo-placeholder.png')}}" alt="" class="img-fluid">
                </div>
                <div class="col-sm-9">
                    <h1>Find the Extreme Ultraviolet Spectrum (EUV) for your Star</h1>
                </div>
            </div>
        </div>

        <div class="row mt-2">
            <div class="col-md-6" id="home-left-col">
                <p class="text-center mb-4"><b>Enter Stellar Parameters Manually</b></p>
                <form action="/" method="POST">
                    {{ parameter_form.csrf_token }}
                    <fieldset>
                        <div class="form-floating mb-3">
                            {{ parameter_form.teff(class="form-control", placeholder="Teff — Stellar Effective Temperature (K)") }}
                            {{ parameter_form.teff.label(text='* ' + parameter_form.teff.label.text) }}
                        </div>
    
                        <div class="form-floating mb-3">
                            {{ parameter_form.logg(class="form-control", placeholder="log g — Surface Gravity (cm/s2)") }}
                            {{ parameter_form.logg.label(text='* ' + parameter_form.logg.label.text) }}
                        </div>
    
                        <div class="form-floating mb-3">
                            {{ parameter_form.mass(class="form-control", placeholder="M ☉ - Mass in Solar Masses") }}
                            {{ parameter_form.mass.label(text='* ' + parameter_form.mass.label.text) }}
                        </div>
    
                        <div class="form-floating mb-3">
                            {{ parameter_form.stell_rad(class="form-control", placeholder="R ☉ — Stellar Radius in Solar Radian") }}
                            {{ parameter_form.stell_rad.label(text='* ' + parameter_form.stell_rad.label.text) }}
                        </div>
    
                        <div class="row">
                            <div class="col-sm-9">
                                <div class="form-floating mb-3">
                                    {{ parameter_form.dist(class="form-control", placeholder="d — Distance") }}
                                    {{ parameter_form.dist.label(text='* ' + parameter_form.dist.label.text) }}
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <div class="form-floating mb-3">
                                    {{ parameter_form.dist_unit(class="form-select") }}
                                    {{ parameter_form.dist_unit.label(text='* ' + parameter_form.dist_unit.label.text) }}
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-end">
                            {{ parameter_form.submit(class="btn btn-primary mb-3") }}
                        </div>
                    </fieldset>
                </form>
            </div>
            
            <div class="col-md-6">
                <p class="text-center mb-4"><b>Search Exoplanet Archive for Stellar Parameters</b></p>
                <!--—————————POSITION FORM——————————-->
                <form action='/' method='POST' id="star_name_form">
                    <fieldset>
                        {{ name_form.csrf_token }}
                        <div class="form-floating mb-3">
                            {{ name_form.name(class="form-control", placeholder="Star Name") }}
                            {{ name_form.name.label }}
                        </div>
                        <div class="d-flex justify-content-end">
                            {{ name_form.submit(class="btn btn-primary mb-3", onclick="displayLoading();") }}
                        </div>
                    </fieldset>
                </form>

                <p id="home-or" class="my-5"><span>or</span></p>

                <!--—————————POSITION FORM——————————-->
                <form action="/" method="POST">
                    <fieldset>
                        {{ position_form.csrf_token }}
                        <div class="form-floating mb-3">
                            {{ position_form.ra(class="form-control", placeholder="RA") }}
                            {{ position_form.ra.label }}
                        </div>
                        <div class="form-floating mb-3">
                            {{ position_form.dec(class="form-control", placeholder="dec") }}
                            {{ position_form.dec.label }}
                        </div>
                        <div class="d-flex justify-content-end">
                            {{ position_form.submit(class="btn btn-primary mb-3", onclick="displayLoading();") }}
                        </div>
                    </fieldset>
                </form>
            </div>
            {% if show_modal %}
                
                <div class="modal fade" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <p class="mt-2 ms-4">
                                    The following catalogs provide data for your target: <b>{{ star_name }}</b> <br> 
                                    Please use the buttons below to view each catalog. Feel free to edit any data, then save and continue.
                                </p>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <fieldset>
                                        {{ star_name_parameters_form.csrf_token }}
                                        <div class="table-responsive">
                                            <table class="table table-borderless align-bottom" id="star_name_parameter_form_table">
                                                <tr>
                                                    <th><small>{{star_name_parameters_form.catalog_name.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.catalog_name %}
                                                        <td>
                                                            {{ subfield.label }}
                                                            <div class="form-check">
                                                                {{ subfield(class="form-check-input", type="checkbox", onclick="selectAll(this);") }}
                                                                <p>Select All</p>
                                                            </div>
                                                        </td>
                                                    {% endfor %}
                                                </tr>

                                                <tr>
                                                    <th><small>{{star_name_parameters_form.teff.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.teff %}
                                                        <td>
                                                            <div class="form-check my-3">
                                                                {{ subfield(class="form-check-input") }}
                                                                {{ subfield.label(class="form-check-label") }}
                                                            </div>
                                                        </td>
                                                    {% endfor %}
                                                </tr>

                                                <tr>
                                                    <th><small>{{star_name_parameters_form.logg.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.logg %}
                                                        <td>
                                                            <div class="form-check my-3">
                                                                {{ subfield(class="form-check-input") }}
                                                                {{ subfield.label(class="form-check-label") }}
                                                            </div>
                                                        </td>
                                                    {% endfor %}
                                                </tr>

                                                <tr>
                                                    <th><small>{{star_name_parameters_form.mass.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.mass %}
                                                        <td>
                                                            <div class="form-check my-3">
                                                                {{ subfield(class="form-check-input") }}
                                                                {{ subfield.label(class="form-check-label") }}
                                                            </div>
                                                        </td>
                                                    {% endfor %}
                                                </tr>

                                                <tr>
                                                    <th><small>{{star_name_parameters_form.stell_rad.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.stell_rad %}
                                                        <td>
                                                            <div class="form-check my-3">
                                                                {{ subfield(class="form-check-input") }}
                                                                {{ subfield.label(class="form-check-label") }}
                                                            </div>
                                                        </td>
                                                    {% endfor %}
                                                </tr>

                                                <tr>
                                                    <th><small>{{star_name_parameters_form.dist.label}}</small></th>
                                                    {% for subfield in star_name_parameters_form.dist %}
                                                        <td>
                                                            <div class="form-check my-3">
                                                                {{ subfield(class="form-check-input") }}
                                                                {{ subfield.label(class="form-check-label") }}
                                                            </div>  
                                                        </td>    
                                                    {% endfor %}
                                                </tr>
                                                
                                            </table>
                                        </div>
                                        <div class="modal-footer">
                                            <form action="/" method="GET">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            </form>
                                            
                                            {{ star_name_parameters_form.submit(class="btn btn-primary") }}
                                            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                                        </div>
                                    </fieldset>
                                </form>

                            </div>
                            
                        </div>
                    </div>
                </div>
                <script>
                    var myModalEl = document.getElementById('myModal');
                    var modal = new bootstrap.Modal(myModalEl);
                    modal.show();
                </script>
            {% endif %}
        </div>
    </div>


    {# <!-- <div class="row mt-2">
        <div class="col-sm-9">
            <div class="form-floating mb-3">
                {{ form.fuv(class="form-control", placeholder="FUV — Far Ultraviolet Spectra in Microjanskys (mjy)") }}
                {{ form.fuv.label }}
            </div>
            <ul>
                {% for error in form.fuv.errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-sm-3">
            <div class="form-floating mb-3">
                {{ form.fuv_flag(class="form-select") }}
                <label for="floatingSelect">Specify</label>
            </div>
        </div>
    </div> -->

    <!-- <div class="row">
        <div class="col-sm-9">
            <div class="form-floating mb-3">
                {{ form.nuv(class="form-control", placeholder="NUV — Near Ultraviolet Spectra in Microjanskys (mjy)") }}
                {{ form.nuv.label }}
            </div>
            <ul>
                {% for error in form.nuv.errors %}
                    <li class="error">{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="col-sm-3">
            <div class="form-floating mb-3">
                {{ form.nuv_flag(class="form-select") }}
                <label for="floatingSelect">Specify</label>
            </div>
        </div>
    </div> --> #}
{% endblock %}

{% block script %}
    <script type="text/javascript">
        // $SCRIPT_ROOT = {{ request.script_root|tojson }};

        function showModal() {
            var myModalEl = document.getElementById('myModal');
            var modal = new bootstrap.Modal(myModalEl);
            modal.show();
        };

        const loader = document.querySelector("#loading");
        const overlay = document.getElementById("overlay");
        // showing loading
        function displayLoading() {
            loader.classList.add("display");
            overlay.style.display = "block";

            // to stop loading after some time
            // setTimeout(() => {
            //     loader.classList.remove("display");
            // }, 10000);
        }
        // hiding loading 
        function hideLoading() {
            loader.classList.remove("display");
            overlay.style.display = "none";
        }

        const form = document.getElementById('star_name_form')
        // form.addEventListener('submit', function(event) {
        //     event.preventDefault();    // prevent page from refreshing
        //     displayLoading()
        //     const formData = new FormData(form);  // grab the data inside the form fields

        //     fetch('/', {   // assuming the backend is hosted on the same server
        //         method: 'POST',
        //         body: formData,
        //     }).then(function(response) {
        //         hideLoading()
        //         response.text().then(function(data) {
        //             console.log(data);

        //             // PARSE DATA
        //             const myObj = JSON.parse(data);
        //             console.log(myObj)
        //             for (var i = 0; i < myObj.length; i++) {
        //                 console.log(myObj[i]);
        //             }

        //             // ACTIVATE MODAL
        //             var myModalEl = document.getElementById('myModal');
        //             var modal = new bootstrap.Modal(myModalEl);
                    
        //             modal.show();

        //             // APPEND TABS FOR EACH CATALOG
        //             const tabCont = document.getElementById('catalog-list-cont');

        //         });
        //     });
        // });

        function selectAll(obj) {
            console.log(obj.id)

            // get all selectall buttons
            const selectAllBtns = document.querySelectorAll(`[id*="catalog_name"]`);
            console.log(selectAllBtns)
            // check to make sure no other select all buttons are checked
            for (i=0; i < selectAllBtns.length; i++) {
                if ( selectAllBtns[i].id != obj.id ) {
                    selectAllBtns[i].checked = false;
                }
            };

            // get identifying number
            const num = obj.id.match(/(\d+)/)[0];
            // get all radios w identifying number
            const btns = document.getElementById('star_name_parameter_form_table').querySelectorAll(`[id*="${num}"]`);
            // check radio btns
            for( i = 0 ; i < btns.length ; i++ ) {
                btns[i].checked = true;
            };
        };

    </script>
{% endblock %}