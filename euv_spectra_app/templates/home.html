{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
    <div class="container">     
        
        <div id="overlay">
            <div class="d-flex justify-content-center">
                <div id="loading"></div>
                <div id="overlay-box">
                    <div class="d-flex justify-content-center align-items-center">
                        <h5 class="mb-4 mt-3">Querying Databases</h5>
                        <p id="overlay-text">Hang tight! This may take up to 2 minutes...</p>
                    </div>
                </div>
            </div>
        </div>

        

        <div class="full-width" id="home-img-cont">
            <img src="{{url_for('static', filename='imgs/logo-blue.png')}}" alt="" class="img-fluid mx-auto d-block" style="width: 400px;">
        </div>

        {#<!-- <div class="col-sm-10 offset-sm-1 mt-1"> 
            <div class="row d-flex align-items-center">
                <div class="col-sm-2">
                    <img src="{{url_for('static', filename='imgs/icon.png')}}" alt="" class="img img-fluid px-3 py-3">
                </div>
                <div class="col-sm-10">
                    <h2>Find the Extreme Ultraviolet Spectrum for your Star</h2>
                </div>
            </div>
            <p>The PHOENIX EUV Grid and Stellar UV Spectra (PEGASUS) webtool returns a generalized high resolution (Δλ < 0.01 Å) synthetic extreme ultraviolet (EUV; 100-1000 Å) spectrum for a searched target star of the M or K spectral type.</p>
            <p>Required inputs for returning a spectrum are effective temperature, surface gravity, mass, radius, distance, and GALEX FUV and NUV fluxes.</p>
            <p>Users have the option to use Star Name or ICRS coordinates to query the catalogs detailed on our <a href="/about">About</a> page to retrieve these parameters or they can enter the values manually.</p>
        </div> -->#}


        <div class="row full-width" id="search-bar-cont">
            <div class="col-sm-8 offset-sm-2 my-3">
                <h5 class="text-center mt-4 mb-5" style="color: white;">Enter Star Name or Coordinates to Get Started</h5>
                <div class="row g-0">
                    <div class="col-sm-4">
                        <div class="form-floating">
                            <select class="form-select" id="search-select" aria-label="Floating label select example" style="border-radius: 0px;">
                                <option selected value="name">Star Name</option>
                                <option value="position">J2000 Coordinates</option>
                            </select>
                            <label for="floatingSelect">Search By</label>
                        </div>
                    </div>
                    
                    <div class="col-sm-8" id="name-form-cont">
                        {% include 'partials/name_form.html' %}
                    </div>

                    <div class="col-sm-8" id="position-form-cont" style="display:none;">
                        {% include 'partials/position_form2.html' %}
                    </div>
                    
                </div>
            </div>
        </div>
        

        

        <p class="text-center mt-3"><a data-bs-toggle="collapse" href="#search" role="button" aria-expanded="false" aria-controls="collapseExample"><b>Click Here to Enter Parameters Manually </b><i class="fa-solid fa-chevron-up"></i></a></p>
        <div class="col-sm-8 offset-sm-2">
            <div class="collapse mb-5" id="search">
                {% include 'partials/parameter_form.html' %}
                <div class="text-center mt-2">
                    <!--—————————MANUAL PARAMETER FORM——————————-->
                    {{ parameter_form.submit(class="btn btn-primary", for="parameter-form", id="flux-continue-btn", form="parameter-form") }}
                </div>
                <div><p class="text-center mt-2"><a href="/clear-session" style="color: tomato;">Clear Form</a> </p></div>
            </div>
        </div>

        <!--—————————MODAL START—————————-->
        {% if session['modal_show'] or (star_name_parameters_form and star_name_parameters_form.errors) %}
            <div class="modal fade" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <p class="mt-2 ms-4">
                                The following catalogs returned data for your target: <b>{{ session.star_name }}</b> <br> 
                                Select the values you wish to use below or enter manually.
                            </p>
                            <a href="/">
                                <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </a>
                        </div>
                        <div class="modal-body">
                            {% for field, errors in star_name_parameters_form.errors.items() %}
                                <div class="alert alert-danger mt-2" role="alert">
                                    {{ star_name_parameters_form[field].label }}: {{ ', '.join(errors) }}
                                </div>
                            {% endfor %}
                            
                            <!--—————————MODAL FORM——————————-->
                            {% include 'partials/modal_form.html' %}
                        </div>
                    </div>
                </div>
            </div>

            <script>
                var myModalEl = document.getElementById('myModal');
                var modal = new bootstrap.Modal(myModalEl);
                modal.show();
            </script>
        {% endif %}
        <!--—————————MODAL END—————————-->


    </div>
{% endblock %}


{% block script %}
    <script src="{{ url_for('static', filename='js/loader.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal_form.js') }}"></script>
    <script src="{{ url_for('static', filename='js/search_bar.js') }}"></script>
    
    <!-- <script>
        function checkSession() {
            var inputs;
            const session = JSON.parse('{{ session|tojson|safe }}');
            console.log(session);

            inputs = document.getElementsByClassName('form-control');

            for (i = 0; i < inputs.length; i++){
                if((session.hasOwnProperty(inputs[i].name)) && (inputs[i].name != 'csrf_token')){
                    if(session[inputs[i].name] == 'null'){
                        console.log('Null value detected')
                        inputs[i].value = -999.0
                        if((inputs[i].name == 'fuv') || (inputs[i].name == 'nuv')) {
                            fluxCont = inputs[i].closest(".row")
                            radioCont = fluxCont.nextElementSibling
                            nullBtn = radioCont.querySelectorAll(`[id*="flag-0"]`)
                            nullBtn[0].checked = true;
                        }
                    } else {
                        console.log(inputs[i]);
                        console.log(session[inputs[i].name]);
                        inputs[i].value = session[inputs[i].name];
                    }
                };};};

        window.onload = checkSession;
    </script> -->
{% endblock %}