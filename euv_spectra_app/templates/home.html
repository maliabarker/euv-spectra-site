{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
    <div class="container" onload="checkSession()">     
        
        <div id="overlay">
            <div class="d-flex justify-content-center">
                <div id="loading"></div>
            </div>
        </div>

        <div class="col-sm-10 offset-sm-1 mt-1"> 
            <div class="row d-flex align-items-center">
                <div class="col-sm-2">
                    <img src="{{url_for('static', filename='imgs/icon.png')}}" alt="" class="img img-fluid px-3 py-3">
                </div>
                <div class="col-sm-10">
                    <h2>Find the Extreme Ultraviolet Spectrum for your Star</h2>
                </div>
            </div>
            <p>The PHOENIX EUV Grid and Stellar UV Spectra (PEGASUS) webtool returns a generalized high resolution (Δλ < 0.01 Å) synthetic extreme ultraviolet (EUV; 100-1000 Å) spectrum for a searched target star of the M or K spectral type.</p>
            <p>Required inputs for returning a spectrum are effective temperature, surface gravity, mass, radius, distance, and GALEX FUV and NUV fluxes.</p>
            <p>Users have the option to use Star Name or ICRS coordinates to query the catalogs detailed on our <a href="/about">About</a> page to retrieve these parameters or they can enter the values manually.</p>
        </div>

        <div class="row mt-5">
            <div class="col-md-6" id="home-left-col">
                <p class="text-center mb-4"><b>Search for Stellar Parameters by Name</b></p>
                <!--—————————NAME FORM——————————-->
                {% include 'partials/name_form.html' %}

                <p id="home-or" class="my-5"><span>or</span></p>

                <p class="text-center mb-4"><b>Search for Stellar Parameters by J2000 Coordinates</b></p>
                <!--—————————POSITION FORM——————————-->
                {% include 'partials/position_form.html' %}
            </div>

            <div class="col-md-6">
                <p class="text-center mb-4"><b>Enter Stellar Parameters and Fluxes Manually</b></p>
                <!--—————————PARAMETER FORM——————————-->
                {% include 'partials/parameter_form.html' %}
            </div>


            {% if session['modal_show'] %}
                <div class="modal fade" id="myModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <p class="mt-2 ms-4">
                                    The following catalogs returned data for your target: <b>{{ session.star_name }}</b> <br> 
                                    Select the values you wish to use below or enter manually.
                                </p>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!--—————————MODAL FORM——————————-->
                                {% include 'partials/modal_form.html' %}
                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    var myModalEl = document.getElementById('myModal');
                    var modal = new bootstrap.Modal(myModalEl);
                    modal.show();
                </script>
            {% endif %}
        </div>

        <div class="text-center my-5">
            {{ parameter_form.submit(class="btn btn-primary", for="parameter-form", id="flux-continue-btn", form="parameter-form") }}
        </div>
    </div>
{% endblock %}

{% block script %}
    <script src="{{ url_for('static', filename='js/loader.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal_form.js') }}"></script>
    <script>
        function checkSession() {
            var inputs;
            const session = JSON.parse('{{ session|tojson|safe }}');
            console.log(session);

            inputs = document.getElementsByClassName('form-control');

            for (i = 0; i < inputs.length; i++){
                if((session.hasOwnProperty(inputs[i].name)) && (inputs[i].name != 'csrf_token')){
                    if(session[inputs[i].name] == 'null'){
                        console.log('Null value detected')
                        inputs[i].value = -999.0
                        if((inputs[i].name == 'fuv') || (inputs[i].name == 'nuv')) {
                            fluxCont = inputs[i].closest(".row")
                            radioCont = fluxCont.nextElementSibling
                            nullBtn = radioCont.querySelectorAll(`[id*="flag-0"]`)
                            nullBtn[0].checked = true;
                        }
                    } else {
                        console.log(inputs[i]);
                        console.log(session[inputs[i].name]);
                        inputs[i].value = session[inputs[i].name];
                    }
                };};};

        window.onload = checkSession;
    </script>
{% endblock %}